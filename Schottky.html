<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <style>
      #A {
        /* width: 700px; */
        height: 700px;
        width: 100%;
        border: 1px solid black;
      }
      textarea {
        resize: vertical;
        height: 100px;
        font-style: monospace;
        width: 100%;
      }

      body {
        min-width: 200px;
        max-width: 700px;
        margin: auto;
        padding: 5px;
      }

    </style>

    <script src="GeoSVG.js"></script>

  </head>

  <body>
    <h1 style="text-align: center">Schottky Group Orbits</h1>
    <svg id="A"></svg>
    <p>Enter pairs of circles, separated by new lines. Example of a circle: [[cx, cy], r]</p>
    <textarea id="input">
[[-1, 1], 1]; [[1, -1], 1]
[[-1, -1], 1]; [[1,1], 1]</textarea>
  <br><br>
  <label>
    Smallest Radius: <input id="smallest-radius" type="number" placeholder="0.05" value="0.05" step="0.001" min="0.00000001"></input>
  </label>
  <br><br>
  <label>
    Zoom: <input id="zoom" type="number" placeholder="100" value="100"></input>
  </label>
  <br><br>
    <br><br>
    <button id="btn" onclick="make_schottky_image()">Make Image!</button>
    <img id="loading" src="loading.gif" style="height: 1em;" hidden/>
    <p id="error" style="color: red"></p>
  </body>


  <script>
    var geoSVG;

    var worker;

    function make_schottky_image() {

      let geoSVG = new GeoSVG(document.getElementById('A'), {
        zoom: Number(document.getElementById('zoom').value)
      });

      document.getElementById('loading').hidden = false;
      document.getElementById('btn').disabled = true;

      if (worker) {
        worker.terminate();
      }

      geoSVG.clear();

      document.getElementById('error').innerHTML = "";

      worker = new Worker('GeoSVG.js');

      worker.onmessage = function(msg) {
        if (msg.data.type == 'error') {
          document.getElementById('error').innerHTML = msg.data.error;
          document.getElementById('loading').hidden = true;
          document.getElementById('btn').disabled = false;
          console.log(msg.data.msg);
        } else if (msg.data.type == 'update') {
          geoSVG.add_circle(msg.data.circle);
        } else { // complete
          document.getElementById('loading').hidden = true;
          document.getElementById('btn').disabled = false;
        }

      }

      let input_circles = document.getElementById('input').value
        .trim()
        .split('\n')
        .map(line => line.split(';').map(list => JSON.parse(list.trim())));

      worker.postMessage({
        purpose: 'schottky',
        info: {
          input_circles: input_circles,
          smallest_radius: Number(document.getElementById('smallest-radius').value.trim())
        },
      });



    }

  </script>


</html>
